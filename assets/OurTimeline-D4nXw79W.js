import{_ as we,j as t}from"./index-oJkx2L23.js";import{b as r}from"./vendor-BO-UU5I_.js";import{C as je,H as Se}from"./CompletionModal-D9ACBJVh.js";const Ne=we(()=>import("./flashback-8TiEQo_a.js"),[]).then(D=>D.default||D),A="our-timeline-progress";function Ee(){const D=r.use(Ne),[x,O]=r.useState([]),[o,E]=r.useState(null),[S,Y]=r.useState([]),[T,z]=r.useState(0),[P,M]=r.useState(0),[ce,d]=r.useState(null),[c,B]=r.useState(!1),[ie,N]=r.useState(!1),[R,H]=r.useState(0),[q,C]=r.useState(!1),[i,I]=r.useState(null),[h,f]=r.useState(null),[_,y]=r.useState(!1),[ue,J]=r.useState(!1),b=r.useRef(null),V=r.useRef(!0),v=r.useRef(null),k=r.useRef(null),$=r.useRef(null),m=r.useRef(null),G=r.useRef(null),W=r.useRef(0),p=r.useRef(null),[de,K]=r.useState(!1);r.useEffect(()=>{localStorage.getItem("our-timeline-wedding-how-to-play")||(K(!0),localStorage.setItem("our-timeline-wedding-how-to-play","true"))},[]),r.useEffect(()=>{G.current=ye});const X=()=>{const n=[...D.events].sort(()=>Math.random()-.5),l=n[0];O([l]);const s=n[1];E(s);const a=n.slice(2);Y(a),z(0),M(0),B(!1),N(!1),H(0),C(!0),I(null),f(null)};r.useEffect(()=>{const e=localStorage.getItem(A);if(e)try{const n=JSON.parse(e);O(n.placedCards||[]),E(n.currentCard||null),Y(n.remainingCards||[]),z(n.score||0),M(n.totalAttempts||0),H(n.elapsedTime||0),B(n.isComplete||!1),n.isComplete&&N(!1)}catch(n){console.error("Failed to parse save state:",n),localStorage.removeItem(A),X()}else X()},[]),r.useEffect(()=>{if(V.current){V.current=!1;return}localStorage.setItem(A,JSON.stringify({placedCards:x,currentCard:o,remainingCards:S,score:T,totalAttempts:P,elapsedTime:R,isComplete:c}))},[x,o,S,T,P,R,c]),r.useEffect(()=>{const e=()=>{document.hidden?C(!1):c||C(!0)};return c||C(!0),document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e),b.current&&clearInterval(b.current)}},[c]),r.useEffect(()=>(q&&!c?b.current=setInterval(()=>{H(e=>e+1)},1e3):b.current&&clearInterval(b.current),()=>{b.current&&clearInterval(b.current)}),[q,c]),r.useEffect(()=>{const e=l=>{G.current&&G.current(l)},n=m.current;if(n)return n.addEventListener("pointerdown",e),()=>{n.removeEventListener("pointerdown",e)}},[]);const Z=e=>{const n=Math.floor(e/60),l=e%60;return`${n}:${l.toString().padStart(2,"0")}`},me=(e,n)=>{const l=new Date(e.sortDate);for(let s=0;s<n.length;s++){const a=new Date(n[s].sortDate);if(l<a)return s}return n.length},Q=e=>{c||i!==null||(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain","dragging"),y(!0))},fe=(e,n)=>{c||i!==null||(e.preventDefault(),e.dataTransfer.dropEffect="move",d(n),f(n))},ge=e=>{e.currentTarget.contains(e.relatedTarget)||d(null)},he=(e,n)=>{c||i!==null||(e.preventDefault(),d(null),f(n),y(!1))},ee=()=>{d(null),y(!1)},te=()=>{if(h===null||!o)return;const e=me(o,x),n=h===e;M(l=>l+1),n?(z(l=>l+1),I("correct")):I("incorrect"),setTimeout(()=>{const l=[...x];l.splice(e,0,o),O(l),S.length>0?(E(S[0]),Y(S.slice(1)),I(null),f(null),d(null)):(E(null),B(!0),N(!0),C(!1))},2e3)},pe=r.useRef(null),xe=r.useRef(null),u=r.useRef(null),L=r.useRef(!1),F=r.useRef({x:0,y:0}),U=(e,n)=>{const l=document.getElementById("placed-cards-container");if(!l)return;const s=l.getBoundingClientRect();if(n<s.top-20){d(null),f(null);return}const a=Array.from(l.querySelectorAll(".placed-card-wrapper"));let j=!1;for(let g=0;g<a.length;g++){const oe=a[g].getBoundingClientRect(),ve=oe.top+oe.height/2;if(n<ve){d(g),f(g),j=!0;break}}j||(d(a.length),f(a.length))},ne=()=>{if(!L.current||k.current===null)return;const e=k.current,n=$.current,l=window.innerHeight,s=100,a=15;let j=!1;if(e<s){const g=Math.max(.1,(s-e)/s);window.scrollBy(0,-a*g),j=!0}else if(e>l-s){const g=Math.max(.1,(e-(l-s))/s);window.scrollBy(0,a*g),j=!0}j&&n!==null&&U(n,e),v.current=requestAnimationFrame(ne)},re=e=>{if(!L.current)return;e.preventDefault(),k.current=e.clientY,$.current=e.clientX,u.current&&(u.current.style.left=`${e.clientX-F.current.x}px`,u.current.style.top=`${e.clientY-F.current.y}px`);const n=Date.now();n-W.current>50&&(U(e.clientX,e.clientY),W.current=n)},w=e=>{p.current&&p.current()},ye=e=>{if(c||i!==null)return;p.current&&p.current();const l=(e.target.nodeType===3?e.target.parentNode:e.target).closest('[draggable="true"]');if(!l)return;e.preventDefault(),m.current&&m.current.setPointerCapture(e.pointerId),pe.current={x:e.clientX,y:e.clientY},k.current=e.clientY,$.current=e.clientX,L.current=!0,y(!0),J(!0),xe.current=l;const s=l.getBoundingClientRect();F.current={x:e.clientX-s.left,y:e.clientY-s.top},u.current&&(u.current.style.display="block",u.current.style.width=`${s.width}px`,u.current.style.left=`${s.left}px`,u.current.style.top=`${s.top}px`),v.current&&cancelAnimationFrame(v.current),ne();const a=m.current;a.addEventListener("pointermove",re),a.addEventListener("pointerup",w),a.addEventListener("pointercancel",w),a.addEventListener("lostpointercapture",w),U(e.clientX,e.clientY),p.current=()=>{L.current=!1,y(!1),J(!1),k.current=null,$.current=null,v.current&&(cancelAnimationFrame(v.current),v.current=null),u.current&&(u.current.style.display="none"),m.current&&(m.current.removeEventListener("pointermove",re),m.current.removeEventListener("pointerup",w),m.current.removeEventListener("pointercancel",w),m.current.removeEventListener("lostpointercapture",w)),p.current=null}};r.useEffect(()=>()=>{p.current&&p.current()},[]);const le=()=>{localStorage.removeItem(A),X()},be=()=>{N(!1)},se=e=>h===e&&o&&t.jsxs("div",{draggable:i===null,onDragStart:Q,onDragEnd:ee,className:`
          bg-timeline-blue dark:bg-timeline-light-blue-alt rounded-lg shadow-lg p-4 sm:p-5 mb-3
          ${i===null?"cursor-move":""}
          ${_?"opacity-50":"opacity-100"}
          transition-all duration-200
          relative
          touch-none
        `,style:{userSelect:"none",WebkitUserSelect:"none"},children:[t.jsx("h3",{className:"font-bold text-lg sm:text-xl text-white mb-2",children:o.title}),t.jsx("p",{className:"text-sm sm:text-base text-gray-100",children:o.description}),i!==null&&t.jsx("div",{className:"absolute top-2 right-2 text-3xl text-white",children:i==="correct"?"âœ“":"âœ—"})]}),ae=(e,n="h-8")=>_&&o&&ce!==e&&h!==e&&t.jsx("div",{onDragOver:l=>fe(l,e),onDragLeave:ge,onDrop:l=>he(l,e),className:`${n} mb-3`,style:{opacity:0,pointerEvents:"auto"}});return t.jsxs("div",{ref:m,className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-4 sm:py-8 px-3 sm:px-4",children:[t.jsx(je,{isOpen:ie,icon:"ðŸŽ‰",message:"You completed the timeline!",primaryButtonText:"New Game",secondaryButtonText:"Show Timeline",onPrimaryAction:le,onSecondaryAction:be,primaryButtonGradient:"from-timeline-light-blue to-green-500",stats:[{label:"Score",value:`${T}/${P}`,gradient:"from-blue-100 to-green-100 dark:from-blue-900/30 dark:to-green-900/30"},{label:"Time",value:Z(R),gradient:"from-blue-100 to-green-100 dark:from-blue-900/30 dark:to-green-900/30"}]}),t.jsx(Se,{isOpen:de,onClose:()=>K(!1),children:t.jsxs("ul",{className:"space-y-2",children:[t.jsx("li",{children:"â€¢ You'll see one event card at a time to place in the timeline of our relationship."}),t.jsx("li",{children:"â€¢ Drag the event to when you think it happened (earlier or later than existing events)."}),t.jsx("li",{children:`â€¢ Click "Confirm Placement" to check if you're right.`}),t.jsx("li",{children:"â€¢ Get 1 point for placing each correctly."})]})}),t.jsxs("div",{className:"w-full max-w-[min(96vw,650px)] mx-auto",children:[t.jsxs("header",{className:"text-center mb-6 sm:mb-8",children:[t.jsx("h1",{style:{fontSize:"clamp(2rem, 5vw, 3rem)"},className:"font-bold mb-2 text-gray-900 dark:text-gray-100",children:"Our Timeline"}),t.jsx("p",{style:{fontSize:"clamp(1rem, 2.5vw, 1.25rem)"},className:"text-gray-600 dark:text-gray-300",children:"Place each event in chronological order"}),t.jsxs("div",{className:"mt-4 flex justify-center gap-6",children:[t.jsxs("div",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-gray-100",children:["Score: ",T,"/",P]}),t.jsx("div",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-gray-100",children:Z(R)})]})]}),o&&!c&&t.jsxs("div",{className:`mb-6 ${h!==null?"invisible absolute pointer-events-none opacity-0":""}`,style:h!==null?{height:0,overflow:"hidden",margin:0}:{},children:[t.jsx("h3",{className:"text-center text-lg font-semibold text-gray-700 dark:text-gray-300 mb-3",children:"Place this event:"}),t.jsxs("div",{draggable:i===null,onDragStart:Q,onDragEnd:ee,className:`
                bg-timeline-blue dark:bg-timeline-light-blue-alt rounded-lg shadow-lg p-4 sm:p-5
                ${i===null?"cursor-move":""}
                ${_?"opacity-50":"opacity-100"}
                transition-all duration-200
                relative
                touch-none
              `,style:{userSelect:"none",WebkitUserSelect:"none"},children:[t.jsx("h3",{className:"font-bold text-lg sm:text-xl text-white mb-2",children:o.title}),t.jsx("p",{className:"text-sm sm:text-base text-gray-100",children:o.description}),i!==null&&t.jsx("div",{className:"absolute top-2 right-2 text-3xl",children:i==="correct"?"âœ“":"âœ—"})]})]}),o&&t.jsx("div",{ref:u,className:"fixed pointer-events-none z-50",style:{display:ue?"block":"none"},children:t.jsxs("div",{className:"bg-timeline-blue dark:bg-timeline-light-blue-alt rounded-lg shadow-2xl p-4 sm:p-5 opacity-90",children:[t.jsx("h3",{className:"font-bold text-lg sm:text-xl text-white mb-2",children:o.title}),t.jsx("p",{className:"text-sm sm:text-base text-gray-100",children:o.description})]})}),h!==null&&i===null&&!c&&t.jsxs("div",{className:"flex justify-center gap-3 mb-4",children:[t.jsx("button",{onClick:()=>{f(null),d(null),y(!1)},className:"btn-cancel",children:"Cancel"}),t.jsx("button",{onClick:te,className:"btn-confirm",children:"Confirm Placement"})]}),t.jsxs("div",{className:"mb-6",id:"placed-cards-container",children:[x.map((e,n)=>t.jsxs("div",{className:"placed-card-wrapper",children:[ae(n),se(n),t.jsxs("div",{className:`
                  bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 sm:p-5 mb-3
                  transition-all duration-200
                `,children:[t.jsx("h3",{className:"font-bold text-lg sm:text-xl text-gray-900 dark:text-gray-100 mb-2",children:e.title}),t.jsx("p",{className:"text-sm sm:text-base text-timeline-blue dark:text-timeline-light-blue font-semibold mb-2",children:e.displayDate}),t.jsx("p",{className:"text-sm sm:text-base text-gray-600 dark:text-gray-300",children:e.description})]})]},`placed-${e.id}`)),ae(x.length,"h-16"),se(x.length)]}),h!==null&&i===null&&!c&&t.jsxs("div",{className:"flex justify-center gap-6 sm:gap-8 mb-6",children:[t.jsx("button",{onClick:()=>{f(null),d(null),y(!1)},className:"btn-cancel",children:"Cancel"}),t.jsx("button",{onClick:te,className:"btn-confirm",children:"Confirm Placement"})]}),c&&t.jsxs("div",{className:"flex justify-center gap-6 sm:gap-8 mb-6",children:[t.jsx("button",{onClick:le,className:"btn-primary bg-gradient-to-r from-timeline-light-blue to-green-500",style:{fontSize:"clamp(0.8rem, 2vw, 0.875rem)"},children:"New Game"}),t.jsx("button",{onClick:()=>N(!0),className:"btn-secondary",style:{fontSize:"clamp(0.8rem, 2vw, 0.875rem)"},children:"Show Score"})]}),t.jsxs("div",{className:"mt-8 sm:mt-12 p-4 sm:p-6 bg-white dark:bg-gray-800 rounded-lg shadow-sm",children:[t.jsx("h2",{style:{fontSize:"clamp(1.125rem, 2.5vw, 1.25rem)"},className:"font-bold mb-3 text-gray-900 dark:text-gray-100",children:"How to Play"}),t.jsxs("ul",{style:{fontSize:"clamp(0.75rem, 2vw, 0.875rem)"},className:"space-y-2 text-gray-700 dark:text-gray-300",children:[t.jsx("li",{children:"â€¢ You'll see one event card at a time to place in the timeline of our relationship."}),t.jsx("li",{children:"â€¢ Drag the card to where you think it belongs (earlier or later than existing events)."}),t.jsx("li",{children:`â€¢ Click "Confirm Placement" to check if you're right.`}),t.jsx("li",{children:"â€¢ Get 1 point for each correct placement. Your score is out of 7 total cards."}),t.jsx("li",{children:"â€¢ The card will automatically move to the correct position after you confirm."})]})]})]})]})}export{Ee as default};
